<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSEB Smart Bill Calc Pro</title>
    <style>
        :root { --primary: #00f2fe; --accent: #4facfe; --bg: #0f172a; --card: #1e293b; --subsidy: #4ade80; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; padding: 20px; }
        .container { background: var(--card); padding: 30px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); width: 100%; max-width: 450px; border: 1px solid #334155; }
        h2 { text-align: center; background: linear-gradient(to right, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 30px; letter-spacing: 1px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        label { display: block; font-size: 11px; text-transform: uppercase; color: #94a3b8; margin-bottom: 5px; letter-spacing: 1px; }
        input, select { width: 100%; padding: 12px; background: #0f172a; border: 1px solid #334155; border-radius: 8px; color: white; box-sizing: border-box; outline: none; transition: 0.3s; font-size: 14px; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(0, 242, 254, 0.2); }
        
        .subsidy-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: rgba(74, 222, 128, 0.05);
            border-radius: 8px;
            border: 1px dashed rgba(74, 222, 128, 0.3);
            cursor: pointer;
        }
        .subsidy-container input { width: auto; cursor: pointer; }
        .subsidy-label { color: var(--subsidy); font-size: 12px; font-weight: 600; cursor: pointer; }

        button { width: 100%; padding: 15px; background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%); color: #0f172a; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 20px; text-transform: uppercase; transition: transform 0.2s; }
        button:active { transform: scale(0.98); }
        
        #resBox { margin-top: 25px; padding: 20px; border-radius: 12px; background: rgba(255,255,255,0.05); display: none; border-left: 4px solid var(--primary); }
        .total-row { font-size: 32px; font-weight: 800; color: var(--primary); margin-top: 5px; }
        .detail { font-size: 13px; color: #94a3b8; margin-bottom: 8px; display: flex; justify-content: space-between; }
        .breakdown { margin-top: 15px; padding-top: 15px; border-top: 1px dashed #334155; font-size: 12px; color: #64748b; line-height: 1.6; }
        .sub-deduction { color: var(--subsidy); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>KSEB BILL PRO</h2>
    
    <div class="grid">
        <div>
            <label>From Date</label>
            <input type="date" id="dateFrom">
        </div>
        <div>
            <label>To Date</label>
            <input type="date" id="dateTo">
        </div>
    </div>

    <div class="grid">
        <div>
            <label>Prev Reading</label>
            <input type="number" id="prev" placeholder="Units">
        </div>
        <div>
            <label>Curr Reading</label>
            <input type="number" id="curr" placeholder="Units">
        </div>
    </div>

    <div class="group">
        <label>Connection Type</label>
        <select id="phase">
            <option value="single">Single Phase</option>
            <option value="three">Three Phase</option>
        </select>
    </div>

    <label class="subsidy-container">
        <input type="checkbox" id="subsidy">
        <span class="subsidy-label">Apply Govt. Subsidy</span>
    </label>

    <button onclick="calc()">Calculate Bill</button>

    <div id="resBox">
        <div class="detail"><span>Period:</span> <b id="days">0</b> Days</div>
        <div class="detail"><span>Consumption:</span> <b id="unitText">0</b> Units</div>
        <div class="detail"><span>Monthly Avg:</span> <b id="avgText">0</b> Units</div>
        <hr style="border: 0; border-top: 1px solid #334155; margin: 10px 0;">
        <div class="detail">Estimated Total Amount:</div>
        <div class="total-row">₹ <span id="total">0.00</span></div>
        
        <div class="breakdown" id="breakdown"></div>
    </div>
</div>

<script>
function calc() {
    const d1 = new Date(document.getElementById('dateFrom').value);
    const d2 = new Date(document.getElementById('dateTo').value);
    const p = parseFloat(document.getElementById('prev').value);
    const c = parseFloat(document.getElementById('curr').value);
    const phase = document.getElementById('phase').value;
    const hasSubsidy = document.getElementById('subsidy').checked;

    if (isNaN(d1) || isNaN(d2) || isNaN(p) || isNaN(c) || c < p) {
        alert("Please enter valid dates and readings."); return;
    }

    const diffDays = Math.max(1, Math.ceil(Math.abs(d2 - d1) / (1000 * 60 * 60 * 24)));
    const units = c - p;
    const months = diffDays / 30; 
    const unitsPerMonth = units / months;

    let ec = 0; // Energy Charge
    let fc = 0; // Fixed Charge

    // 1. FIXED CHARGE LOGIC
    if (phase === 'single') {
        if (unitsPerMonth <= 50) fc = 0;
        else if (unitsPerMonth <= 100) fc = 55;
        else if (unitsPerMonth <= 150) fc = 70;
        else if (unitsPerMonth <= 200) fc = 100;
        else if (unitsPerMonth <= 250) fc = 110;
        else fc = 130; 
    } else {
        if (unitsPerMonth <= 100) fc = 120;
        else fc = 175;
    }
    let totalFC = fc * months;

    // 2. ENERGY CHARGE LOGIC
    if (unitsPerMonth <= 250) {
        let rem = units;
        let slab = 50 * months;
        let s1 = Math.min(rem, slab); ec += s1 * 3.15; rem -= s1;
        let s2 = Math.min(rem, slab); ec += s2 * 3.95; rem -= s2;
        let s3 = Math.min(rem, slab); ec += s3 * 5.00; rem -= s3;
        let s4 = Math.min(rem, slab); ec += s4 * 6.80; rem -= s4;
        ec += rem * 8.00;
    } else {
        if (unitsPerMonth <= 300) ec = units * 6.20;
        else if (unitsPerMonth <= 350) ec = units * 7.00;
        else if (unitsPerMonth <= 400) ec = units * 7.35;
        else if (unitsPerMonth <= 500) ec = units * 7.60;
        else ec = units * 8.50;
    }

    const duty = ec * 0.10; 
    const misc = 82 * months;
    const subAmt = hasSubsidy ? (65 * months) : 0;
    
    // Final Calculation
    const grossTotal = totalFC + ec + duty + misc;
    const finalTotal = Math.max(0, grossTotal - subAmt);

    // Update UI
    document.getElementById('days').innerText = diffDays;
    document.getElementById('unitText').innerText = units;
    document.getElementById('avgText').innerText = unitsPerMonth.toFixed(1);
    document.getElementById('total').innerText = finalTotal.toFixed(2);
    
    let breakdownHtml = `
        EC: ₹${ec.toFixed(2)} | FC: ₹${totalFC.toFixed(2)}<br>
        Duty: ₹${duty.toFixed(2)} | Misc: ₹${misc.toFixed(2)}
    `;
    
    if (hasSubsidy) {
        breakdownHtml += `<br><span class="sub-deduction">Govt Subsidy Applied: -₹${subAmt.toFixed(2)}</span>`;
    }

    document.getElementById('breakdown').innerHTML = breakdownHtml;
    document.getElementById('resBox').style.display = 'block';
}
</script>
</body>
</html>
